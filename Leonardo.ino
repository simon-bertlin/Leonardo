
#include <Keyboard.h>
const unsigned short sleepTime[] PROGMEM = {136, 130, 166, 118, 164, 148, 194, 150, 224, 164, 93, 77, 132, 219, 194, 95, 66, 78, 16, 91, 132, 168, 57, 172, 
162, 47, 165, 165, 178, 211, 194, 132, 133, 163, 241, 184, 125, 141, 180, 184, 200, 274, 166, 16, 156, 233, 195, 179, 270, 
163, 116, 148, 54, 148, 188, 180, 243, 155, 112, 227, 219, 134, 199, 214, 133, 211, 104, 196, 194, 159, 160, 148, 242, 110, 
181, 163, 81, 164, 105, 258, 145, 178, 120, 165, 157, 125, 163, 44, 94, 94, 210, 172, 149, 146, 211, 227, 166, 141, 245, 
159, 165, 274, 101, 16, 119, 150, 201, 136, 153, 226, 165, 194, 273, 217, 232, 213, 163, 125, 178, 148, 115, 195, 227, 142, 
224, 203, 277, 141, 163, 16, 78, 241, 144, 225, 164, 125, 167, 227, 127, 16, 78, 97, 179, 260, 127, 164, 180, 180, 132, 
16, 31, 225, 112, 171, 175, 391, 178, 172, 263, 199, 147, 147, 164, 212, 193, 16, 31, 16, 384, 150, 214, 63, 1111, 254, 
131, 179, 107, 141, 212, 132, 52, 55, 56, 106, 88, 101, 125, 133, 163, 522, 175, 132, 135, 162, 16, 141, 226, 147, 124, 
108, 149, 179, 170, 163, 179, 157, 133, 148, 34, 109, 79, 105, 174, 130, 137, 150, 168, 153, 16, 91, 124, 198, 162, 149, 
195, 180, 149, 132, 16, 94, 383, 192, 147, 181, 182, 125, 318, 149, 447, 192, 156, 16, 94, 181, 194, 142, 47, 163, 166, 
145, 196, 165, 149, 178, 22, 78, 16, 166, 193, 228, 173, 554, 135, 199, 166, 199, 179, 195, 54, 125, 181, 16, 251, 132, 
178, 16, 134, 160, 174, 120, 201, 178, 182, 194, 195, 163, 131, 16, 78, 178, 165, 144, 209, 132, 392, 148, 174, 164, 136, 
16, 94, 148, 16, 16, 178, 132, 187, 195, 178, 187, 211, 181, 16, 109, 197, 162, 164, 194, 181, 157, 141, 16, 116, 163, 
167, 16, 78, 143, 164, 196, 195, 164, 162, 180, 16, 109, 131, 220, 164, 184, 152, 199, 163, 16, 125, 175, 111, 180, 20, 
78, 236, 86, 16, 133, 186, 16, 78, 195, 211, 16, 447, 16, 47, 16, 47, 149, 16, 62, 180, 178, 195, 211, 196, 234, 
148, 199, 210, 213, 209, 189, 125, 146, 219, 16, 94, 135, 166, 243, 127, 181, 95, 149, 107, 169, 181, 215, 182, 195, 172, 
129, 180, 164, 16, 168, 194, 198, 210, 196, 195, 177, 203, 194, 167, 211, 14, 141, 157, 147, 16, 78, 178, 202, 136, 215, 
195, 191, 109, 211, 196, 180, 212, 195, 153, 179, 229, 150, 15, 406, 164, 178, 142, 181, 141, 156, 178, 216, 148, 213, 195, 
211, 55, 94, 226, 132, 224, 135, 150, 198, 210, 209, 163, 188, 196, 178, 200, 225, 191, 173, 127, 16, 94, 16, 94, 232, 
241, 163, 195, 147, 16, 109, 179, 66, 47, 55, 78, 16, 156, 149, 77, 78, 218, 150, 169, 196, 16, 109, 35, 355, 178, 
152, 251, 156, 151, 182, 118, 195, 197, 155, 164, 242, 145, 195, 234, 151, 261, 225, 206, 180, 126, 94, 125, 142, 109, 16, 
94, 180, 165, 195, 149, 55, 110, 66, 78, 184, 213, 130, 195, 243, 203, 165, 215, 243, 196, 210, 125, 16, 116, 152, 16, 
98, 590, 86, 45, 312, 142, 108, 163, 155, 99, 165, 16, 31, 163, 165, 212, 133, 164, 221, 200, 116, 141, 122, 195, 16, 
927, 57, 104, 55, 77, 116, 93, 119, 310, 117, 181, 162, 347, 184, 597, 202, 213, 117, 472, 134, 100, 149, 152, 136, 123, 
194, 263, 148, 160, 172, 133, 211, 491, 132, 107, 163, 194, 148, 211, 163, 78, 164, 147, 154, 195, 226, 178, 178, 187, 180, 
277, 133, 195, 141, 164, 163, 54, 78, 181, 178, 16, 84, 303, 74, 62, 179, 227, 152, 178, 151, 579, 132, 104, 133, 115, 
164, 181, 336, 148, 148, 125, 105, 506, 71, 179, 16, 16, 31, 212, 118, 151, 109, 109, 154, 248, 74, 185, 147, 305, 116, 
16, 47, 16, 156, 110, 125, 212, 125, 143, 102, 151, 195, 79, 163, 128, 163, 163, 148, 147, 78, 163, 133, 149, 123, 109, 
113, 118, 198, 180, 16, 109, 132, 92, 147, 147, 162, 199, 107, 151, 132, 200, 116, 183, 138, 203, 152, 134, 149, 185, 147, 
16, 47, 195, 115, 308, 163, 112, 154, 131, 134, 148, 149, 121, 167, 125, 153, 135, 16, 75, 16, 94, 128, 124, 16, 27, 
162, 163, 90, 163, 123, 62, 132, 137, 153, 90, 148, 138, 219, 109, 143, 94, 148, 394, 147, 204, 132, 178, 304, 172, 139, 
199, 123, 137, 109, 109, 194, 116, 147, 16, 94, 140, 157, 95, 16, 62, 94, 109, 95, 257, 116, 178, 150, 132, 151, 132, 
16, 68, 164, 146, 146, 74, 226, 16, 140, 109, 115, 89, 202, 62, 178, 86, 163, 101, 164, 143, 124, 155, 99, 100, 146, 
282, 136, 182, 150, 16, 30, 369, 62, 121, 228, 93, 178, 132, 164, 163, 90, 154, 114, 103, 219, 88, 207, 16, 178, 123, 
100, 166, 122, 108, 142, 546, 115, 47, 234, 355, 138, 128, 16, 94, 16, 101, 135, 205, 88, 163, 125, 134, 534, 121, 16, 
47, 124, 16, 116, 125, 105, 148, 91, 172, 147, 132, 162, 95, 164, 144, 106, 149, 148, 180, 94, 16, 31, 131, 116, 15, 
31, 133, 149, 164, 115, 163, 137, 116, 149, 147, 124, 16, 16, 16, 62, 130, 149, 125, 117, 166, 124, 131, 102, 232, 100, 
153, 163, 111, 165, 116, 194, 141, 148, 147, 126, 117, 132, 226, 117, 163, 168, 162, 165, 118, 133, 195, 123, 149, 152, 133, 
168, 149, 450, 126, 86, 132, 110, 147, 131, 148, 142, 122, 16, 15, 148, 92, 145, 154, 258, 201, 104, 186, 141, 216, 122, 
16, 18, 134, 150, 94, 124, 148, 166, 111, 148, 134, 16, 109, 135, 92, 168, 74, 131, 116, 163, 94, 154, 165, 94, 169, 
136, 132, 134, 194, 90, 162, 180, 16, 16, 139, 163, 181, 93, 15, 47, 149, 194, 116, 195, 126, 120, 179, 102, 16, 16, 
118, 146, 110, 158, 94, 165, 102, 934, 105, 93, 91, 117, 163, 96, 162, 116, 107, 101, 133, 92, 113, 132, 78, 164, 88, 
164, 105, 105, 131, 92, 131, 133, 177, 106, 165, 137, 48, 16, 94, 117, 211, 111, 109, 268, 109, 218, 109, 116, 123, 147, 
189, 16, 134, 180, 167, 16, 94, 158, 16, 16, 16, 78, 119, 163, 117, 197, 178, 134, 162, 133, 121, 16, 78, 195, 163, 
126, 180, 94, 135, 179, 139, 167, 93, 165, 201, 16, 16, 16, 19, 85, 132, 167, 78, 180, 132, 164, 149, 99, 16, 16, 
117, 134, 161, 131, 141, 101, 179, 121, 102, 154, 103, 167, 122, 147, 149, 180, 118, 150, 142, 196, 371, 391, 210, 165, 186, 
162, 366, 187, 78, 132, 16, 47, 118, 16, 94, 120, 123, 152, 148, 164, 89, 16, 47, 140, 16, 16, 147, 109, 110, 108, 
151, 120, 185, 136, 132, 132, 133, 164, 16, 47, 91, 364, 149, 166, 107, 184, 148, 146, 89, 16, 117, 88, 179, 93, 178, 
90, 196, 179, 132, 107, 16, 141, 94, 132, 147, 16, 16, 165, 16, 16, 138, 198, 112, 105, 163, 117, 101, 177, 103, 16, 
16, 116, 134, 102, 170, 115, 153, 134, 183, 129, 141, 78, 109, 162, 109, 134, 141, 128, 105, 16, 165, 62, 137, 122, 194, 
147, 424, 101, 147, 117, 136, 107, 199, 105, 157, 93, 147, 93, 179, 15, 242, 78, 148, 78, 154, 109, 114, 125, 102, 109, 
254, 104, 173, 94, 129, 204, 47, 147, 180, 187, 114, 126, 75, 153, 135, 62, 141, 108, 112, 117, 133, 155, 116, 16, 31, 
179, 78, 194, 195, 119, 128, 140, 127, 156, 114, 138, 116, 148, 132, 147, 116, 55};

const unsigned short releaseTime[] PROGMEM = {66, 
58, 49, 94, 98, 56, 99, 105, 102, 96, 56, 66, 87, 101, 83, 51, 136, 136, 71, 70, 148, 75, 47, 102, 85, 73, 
106, 74, 76, 71, 87, 89, 52, 32, 57, 90, 73, 69, 61, 64, 120, 63, 88, 91, 89, 66, 75, 102, 123, 71, 59, 
105, 60, 53, 99, 106, 52, 47, 69, 64, 86, 57, 102, 73, 59, 31, 89, 110, 43, 91, 72, 63, 100, 56, 104, 0, 
75, 75, 103, 85, 56, 91, 122, 29, 73, 39, 62, 73, 102, 90, 57, 34, 92, 74, 114, 86, 78, 136, 62, 58, 59, 
90, 114, 91, 87, 102, 79, 68, 64, 75, 40, 72, 90, 56, 102, 89, 48, 74, 19, 97, 39, 93, 136, 105, 58, 91, 
37, 18, 75, 85, 60, 118, 54, 115, 104, 20, 81, 88, 89, 71, 152, 102, 38, 57, 58, 61, 95, 49, 79, 56, 59, 
72, 115, 103, 92, 128, 132, 51, 21, 48, 102, 58, 50, 89, 58, 57, 89, 74, 419, 121, 34, 106, 85, 57, 51, 70, 
86, 83, 134, 61, 93, 55, 56, 72, 103, 57, 96, 88, 38, 74, 106, 134, 50, 72, 71, 86, 70, 68, 72, 69, 125, 
71, 88, 87, 88, 85, 104, 56, 59, 124, 103, 20, 75, 113, 72, 34, 105, 69, 105, 71, 42, 160, 104, 104, 58, 74, 
73, 58, 73, 88, 58, 73, 87, 131, 150, 84, 106, 37, 95, 39, 55, 54, 92, 87, 107, 130, 61, 182, 62, 106, 121, 
62, 50, 50, 104, 85, 88, 71, 95, 59, 82, 119, 89, 57, 53, 91, 76, 86, 92, 97, 72, 73, 146, 89, 133, 101, 
72, 104, 105, 74, 105, 114, 74, 140, 114, 73, 87, 88, 58, 43, 59, 126, 85, 88, 118, 59, 102, 103, 88, 60, 73, 
91, 126, 53, 71, 42, 61, 51, 106, 71, 135, 60, 52, 88, 125, 90, 44, 126, 70, 127, 103, 104, 138, 118, 138, 103, 
129, 87, 87, 89, 105, 75, 90, 85, 88, 86, 89, 74, 52, 42, 75, 104, 134, 105, 115, 102, 46, 89, 54, 87, 67, 
71, 68, 75, 73, 74, 43, 65, 72, 95, 124, 98, 74, 87, 98, 73, 75, 105, 99, 105, 101, 153, 60, 75, 123, 74, 
88, 68, 89, 86, 53, 7, 75, 90, 89, 103, 90, 72, 99, 104, 57, 140, 92, 71, 55, 58, 47, 59, 78, 89, 86, 
87, 70, 112, 131, 89, 58, 85, 53, 69, 87, 103, 80, 76, 64, 61, 98, 58, 87, 56, 60, 56, 127, 129, 91, 102, 
81, 89, 75, 128, 90, 135, 148, 126, 108, 124, 90, 48, 76, 98, 145, 148, 78, 58, 90, 12, 41, 68, 42, 84, 75, 
56, 59, 87, 68, 72, 59, 31, 67, 81, 44, 54, 40, 34, 57, 53, 21, 140, 73, 108, 104, 74, 153, 124, 105, 116, 
46, 71, 108, 77, 67, 60, 87, 77, 74, 31, 141, 62, 127, 71, 44, 139, 66, 64, 89, 52, 45, 99, 146, 85, 104, 
101, 58, 71, 58, 60, 62, 73, 89, 103, 22, 84, 55, 70, 131, 86, 69, 67, 41, 58, 86, 87, 57, 83, 54, 81, 
67, 54, 69, 73, 34, 49, 75, 51, 59, 88, 74, 57, 57, 71, 58, 102, 75, 62, 56, 72, 72, 87, 102, 75, 42, 
87, 72, 57, 87, 58, 92, 74, 89, 98, 71, 75, 116, 40, 87, 72, 131, 73, 75, 128, 86, 127, 88, 105, 90, 84, 
58, 62, 58, 75, 100, 86, 85, 105, 87, 114, 55, 64, 58, 89, 57, 99, 243, 104, 87, 84, 44, 29, 58, 106, 58, 
87, 83, 56, 59, 122, 138, 42, 44, 58, 27, 53, 105, 68, 87, 32, 85, 62, 83, 57, 100, 51, 31, 72, 88, 70, 
44, 39, 51, 69, 87, 102, 131, 74, 55, 70, 72, 83, 89, 64, 103, 84, 102, 85, 86, 69, 57, 70, 52, 68, 103, 
68, 128, 87, 51, 67, 84, 51, 60, 74, 115, 85, 87, 52, 73, 44, 107, 67, 137, 148, 67, 71, 129, 99, 52, 69, 
86, 56, 25, 87, 65, 59, 47, 87, 71, 74, 38, 58, 38, 72, 105, 101, 71, 85, 71, 83, 67, 70, 74, 63, 49, 
34, 55, 87, 75, 86, 133, 54, 59, 39, 120, 37, 47, 58, 99, 79, 102, 103, 70, 102, 83, 119, 85, 73, 85, 57, 
103, 1, 84, 40, 34, 47, 56, 17, 88, 56, 100, 56, 86, 60, 70, 56, 70, 84, 85, 88, 56, 59, 99, 126, 95, 
41, 72, 95, 60, 55, 74, 72, 72, 56, 65, 57, 51, 72, 65, 71, 1, 118, 58, 71, 85, 57, 48, 41, 60, 30, 
31, 102, 68, 54, 53, 128, 133, 60, 59, 69, 100, 30, 59, 86, 53, 127, 72, 122, 44, 60, 88, 58, 94, 72, 76, 
71, 57, 85, 62, 68, 103, 85, 87, 40, 128, 86, 86, 122, 103, 100, 87, 72, 69, 73, 82, 102, 85, 72, 122, 137, 
88, 101, 86, 86, 116, 65, 69, 114, 114, 87, 85, 83, 70, 101, 86, 102, 58, 89, 87, 81, 102, 100, 103, 90, 85, 
58, 90, 56, 57, 86, 85, 57, 101, 86, 99, 85, 67, 106, 41, 51, 87, 64, 102, 87, 101, 71, 69, 322, 53, 79, 
53, 85, 53, 69, 85, 22, 108, 49, 289, 59, 32, 56, 90, 72, 51, 72, 56, 119, 60, 56, 71, 40, 71, 87, 86, 
66, 70, 74, 38, 88, 68, 89, 102, 85, 59, 87, 74, 133, 116, 87, 98, 61, 119, 102, 103, 58, 102, 57, 72, 99, 
56, 122, 85, 89, 72, 93, 56, 103, 70, 86, 68, 56, 71, 86, 84, 57, 86, 72, 71, 55, 85, 63, 73, 71, 68, 
107, 56, 86, 72, 70, 71, 52, 74, 103, 86, 57, 72, 54, 53, 138, 74, 102, 51, 73, 87, 22, 89, 20, 49, 68, 
105, 97, 122, 68, 89, 136, 58, 371, 57, 88, 73, 101, 73, 91, 103, 87, 71, 126, 104, 73, 72, 57, 57, 87, 115, 
57, 59, 13, 107, 86, 584, 100, 71, 42, 112, 71, 102, 103, 62, 165, 74, 50, 58, 75, 72, 72, 101, 55, 56, 72, 
71, 70, 68, 87, 102, 117, 102, 50, 51, 58, 60, 82, 92, 60, 74, 60, 74, 17, 21, 73, 121, 86, 134, 58, 71, 
73, 83, 71, 58, 121, 72, 130, 139, 48, 36, 49, 73, 64, 87, 57, 59, 71, 103, 99, 120, 55, 103, 88, 85, 60, 
103, 68, 56, 47, 119, 54, 88, 56, 87, 58, 103, 106, 87, 63, 141, 18, 74, 104, 119, 118, 304, 68, 61, 69, 88, 
71, 70, 104, 57, 120, 101, 86, 58, 87, 82, 61, 76, 48, 48, 19, 20, 43, 43, 6, 33, 25, 59, 58, 147, 13, 
72, 74, 71, 107, 87, 62, 85, 72, 53, 66, 86, 68, 57, 59, 71, 55, 71, 221, 36, 72, 50, 52, 10, 29, 35, 
3, 29, 59, 71, 70, 35, 57, 43, 1, 93, 56, 38, 40, 70, 55, 86, 68, 58, 103, 53, 56, 69, 71, 70, 90, 
127, 85, 47, 88, 107, 58, 69, 73, 54, 72, 49, 68, 73, 102, 86, 85, 70, 119, 57, 93, 85, 71, 48, 72, 68, 
101, 86, 71, 38, 87, 71, 73, 78, 85, 86, 100, 70, 55, 102, 72, 61, 72, 7, 76, 48, 64, 86, 74, 122, 106, 
382, 44, 75, 71, 88, 57, 102, 55, 52, 127, 86, 87, 102, 58, 59, 90, 157, 60, 57, 71, 86, 57, 89, 71, 123, 
117, 88, 56, 72, 85, 123, 57, 74, 72, 87, 73, 86, 55, 87, 82, 86, 85, 133, 57, 106, 58, 87, 46, 33, 141, 
102, 41, 69, 39, 93, 50, 73, 70, 35, 56, 102, 89, 73, 56, 90, 33, 77, 121, 103, 56, 57, 73, 57, 158, 61, 
98, 71, 55, 72, 89, 134, 19, 88, 60, 85, 57, 132, 86, 55, 78};


const unsigned short sizeOfSleepTime = sizeof(sleepTime) / sizeof(sleepTime[0]);
const unsigned short sizeOfReleaseTime = sizeof(releaseTime) / sizeof(releaseTime[0]);
unsigned long timeSinceLastLoot = millis();
unsigned long lootTimer = 120000;

const unsigned char timer = 'v';
const unsigned char destroyButton = 'p'; //usually 0
const unsigned char lootButt = '2';
const unsigned char extraButton = 'p'; // usually . 
const unsigned char mainSkill = ',';
const unsigned char disabledSign = 'p';


bool isRunning = true;

void setup() {
  pinMode(2, INPUT_PULLUP);
  Keyboard.begin();

}

void loop() {
  //Do nothing until we cable is pulled.
  while (digitalRead(2)) {
    delay(500);
  }
  timeSinceLastLoot = millis();
  isRunning = true;
  while(isRunning){
    runLoop();
    int distract = random(1,10);
    if(distract == 1){
      distracted();
    }
  }
}

void runLoop(){
    int offsetPress = random(45,130);
    int offsetRelease = random(10,45);
    for(byte index = 0; index < sizeOfSleepTime && index < sizeOfReleaseTime; index++){
      Keyboard.press(mainSkill);
      delay(pgm_read_word_near(sleepTime + index) + offsetRelease);
      Keyboard.release(mainSkill);
      delay(pgm_read_word_near(sleepTime + index) + offsetPress);
      if(digitalRead(2)){
        return;
      }
      if(millis() - timeSinceLastLoot >= lootTimer){
        if(!loot()){
          return;
        }
      }
  }
}

void distracted(){
  short int distractedTime = random(5000,10000);
  unsigned long previousTime = millis();
  while(1){
    if(millis() - previousTime >= distractedTime){
      break;
    }
    if(digitalRead(2)){
      isRunning = false;
      break;
    }
  }
}


bool loot(){
  const unsigned short sleepLootTime[] = {84, 110, 105, 139, 121, 129, 168, 170, 211, 177, 160, 119, 151, 179, 140, 191, 189, 198, 202, 170, 157, 211, 142, 199, 
  184, 184, 145, 233, 169, 209, 209, 197, 202, 209, 189, 231};
  const unsigned short releaseLootTime[] = {24, 60, 34, 35, 38, 64, 52, 47, 43, 92, 49, 48, 64, 74, 29, 51, 78, 75, 91, 54, 64, 76, 42, 81, 79, 58, 79, 97, 76,
  78, 67, 91, 90, 100, 78, 55, 45, 91};
  const unsigned short sizeOfLootArray = sizeof(sleepLootTime) / sizeof(sleepLootTime[0]);
  const unsigned short sizeOfLootReleaseTime = sizeof(releaseLootTime) / sizeof(releaseLootTime[0]);
  
  int offsetPress = random(50,150);
  int offsetRelease = random(10,55);
  for(int index = 1; index < sizeOfLootArray && index < sizeOfLootReleaseTime; index++){
    Keyboard.press(lootButt);
    delay(releaseLootTime[index] + offsetRelease);
    Keyboard.release(lootButt);
    delay(sleepLootTime[index] + offsetPress);
    if(digitalRead(2)){
      timeSinceLastLoot = millis();
      return false;
     }
  }
  
  timeSinceLastLoot = millis();
  lootTimer = random(110000,120000);
  if(extraButton != disabledSign){
    pushExtraButton();
  }
  toggleIngameTimer();
  if(destroyButton != disabledSign){
    destroy();
  }
  return true;
}

void pushExtraButton(){
  Keyboard.press(extraButton);
  delay(random(50,80));
  Keyboard.release(extraButton);
  delay(random(100,400));
}

void destroy(){
 int destroyChance = random(1,10);
 if(destroyChance <= 7){
  Keyboard.press(destroyButton);
  delay(random(45,95));
  Keyboard.release(destroyButton);
  delay(random(100,350));
 }
}

void toggleIngameTimer(){
 int destroyChance = random(1,10);
 if(destroyChance <= 9){
  Keyboard.press(timer);
  delay(random(45,95));
  Keyboard.release(timer);
  delay(random(100,350));
 }
}
